#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>
#include <sys/ioctl.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <sys/mman.h>
#include <fcntl.h>
#include <errno.h>
#include "../kernel/msm/include/uapi/sound/devdep_params.h"
#include "../kernel/msm/include/media/msmb_isp.h"

#define DOLBY_PARAM_ID_VSPE            0x00010750
#define DOLBY_PARAM_VCNB_OFFSET        0x2d1
#define DOLBY_PARAM_ID_VER             0x00010726
#define VMSGSI _IOWR('V',195, unsigned int)

struct msm_camera_csid_vc_cfg{
unsigned char cid;
unsigned char dt;
unsigned char decode_format;

};

struct msm_camera_csid_lut_params{
unsigned char num_cid;
struct msm_camera_csid_vc_cfg *vc_cfg[16];

};
struct msm_camera_csid_params{
unsigned char lane_cnt;
unsigned short lane_assign;
unsigned char phy_sel;
struct msm_camera_csid_lut_params lut_params;

};

enum csid_cfg_type_t{
  CSID_INIT,
  CSID_CFG,
  CSID_RELEASE,

};

struct csid_cfg_data{
enum csid_cfg_type_t cfgtype;
union{
  unsigned int csid_version;
  struct msm_camera_csid_params *csid_params;

}cfg;

};


#define CMCIC _IOWR('V', 197, struct csid_cfg_data)

void test_isp_set_src_state()
{
       int fd, i, k,ret;
       char dev[36] = { 0 };
      
       i =3;
       snprintf(dev, sizeof(dev), "/dev/v4l-subdev%d", i);
       printf("open:%s\n",dev);

        fd = open(dev, O_RDWR);
        if (fd < 0) {
                printf("Failed to open:%s\n", dev);
                exit(EXIT_FAILURE);
        }

       printf("ioctl on init csid\n");     
       struct csid_cfg_data ccd;
       ccd.cfgtype=0;
       ccd.cfg.csid_version = 0x02001000;
       ret =ioctl(fd,CMCIC,&ccd);    
       printf("ioctl on cfg, ret:0x%x\n", ret);
       ccd.cfgtype=1;
       ccd.cfg.csid_params = malloc(sizeof(struct msm_camera_csid_params));   
       ccd.cfg.csid_params->lut_params.num_cid=4;
       ccd.cfg.csid_params->lut_params.vc_cfg[1]=(void*)0xffffffc0deadbeaf;    
       ioctl(fd, CMCIC, &ccd);
       printf("ret:0x%x\n",ret);
      }
}


int main(int argc, char *argv[])
{ 
        test_isp_set_src_state();
	return 0;
}

